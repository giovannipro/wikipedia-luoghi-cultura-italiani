const container="#dv2",font_size=10,filter_item=50,shiftx_article=30,wiki_link="https://it.wikipedia.org/wiki/",variation_line_opacity=.7,min_avg_pv=100,stroke_dash="3,3",log_exponent=.5;let window_w=document.getElementById("dv2").offsetWidth;window_h=document.getElementById("dv2").offsetHeight,reduction=window_w<=768?20:0;let margin={top:20,left:0-reduction,bottom:20,right:60-reduction},width=window_w-(margin.right+margin.right),height=window_h-(margin.top+margin.bottom);function dv2(){d3.tsv("../assets/data/voci.tsv").then((function(t){t=format_data(t),filtered_data=t.filter((t=>t.avg_pv>50)),console.log(filtered_data.length);let i=d3.select("#dv2").append("svg").attr("width",width+(margin.right+margin.right)).attr("height",height+(margin.top+margin.bottom)).attr("id","svg"),e=filtered_data.length,a=d3.max(filtered_data,(function(t){return t.avg_pv})),r=d3.max(filtered_data,(function(t){return Math.sqrt(t.size/3.14)})),n=d3.scaleLinear().range([0,20]).domain([0,r]),s=d3.scaleLinear().domain([0,e]).range([0,width-100]),l=d3.scaleLinear().domain([0,a+a/100*10]).range([height-margin.top,0]),o=(i.append("g").attr("id","grid").attr("transform","translate(-1,"+2*margin.top+")").call(d3.axisLeft(l).tickSize(-width-margin.left-margin.right-60)),i.append("g").attr("id","d3_plot").attr("transform","translate("+margin.right+","+margin.top+")")),c=10;window_w<700&&(c=0);o.append("g").attr("id","yAxis").attr("transform","translate("+c+","+margin.top+")").call(d3.axisLeft(l)).selectAll("text").attr("y",-10),o.append("g").attr("class","yaxis_label").attr("transform","translate(7,"+height+")").append("text").attr("class","axis_name").text("visite giornaliere (media)").attr("data-it","visite giornaliere (media)").attr("data-en","daily visits (average)").attr("y",-6).attr("font-size",10);let d=d3.tip().attr("class","tooltip").attr("id","tooltip_dv1").direction((function(t,i){return"n"})).offset([-10,0]).html((function(t,i){let e=new URLSearchParams(window.location.search);1==e.has("lang")&&(lang=e.get("lang")),"it"==lang?(creation_date="Creato il: ",visits="visite giornaliere",size="dimensioni",p="discussione",issues="avvisi",images="immagini",g="incipit",references="riferimenti bibliog.",notes="note"):(creation_date="Created on: ",visits="daily visits",size="size",p="discussion",issues="issues",images="images",g="lead section",references="references",notes="notes");let a="<p style='margin: 0 0 8px 3px;'><span style='font-weight: bold;'>"+t.article+"</span><br/>";return a+="<table>",a+="<tr><td class='label'>"+visits+"</td><td class='value'>"+t.avg_pv.toLocaleString(),"-"!==t.avg_pv_prev&&(a+="<td class='value "+variation_perc(t.avg_pv,t.avg_pv_prev,"visits")[0]+"'>"+variation_perc(t.avg_pv,t.avg_pv_prev,"visits")[1]+"</td></tr>"),a+="<tr><td class='label'>"+size+"</td><td class='value'><td class='value "+t.size+"'>"+t.size.toLocaleString()+"</td></tr>",a+="<tr><td class='label'>"+p+"</td><td class='value'><td class='value "+t.discussion_size+"'>"+t.discussion_size.toLocaleString()+"</td></tr>",a+="<tr><td class='label'>"+g+"</td><td class='value'><td class='value "+t.incipit_size+"'>"+t.incipit_size.toLocaleString()+"</td></tr>",a+="<tr><td class='label'>"+issues+"</td><td class='value'><td class='value "+t.issues+"'>"+t.issues.toLocaleString()+"</td></tr>",a+="<tr><td class='label'>"+images+"</td><td class='value'><td class='value "+t.images+"'>"+t.images.toLocaleString()+"</td></tr>",a+="</table>",a}));o.call(d);let u=o.append("g").attr("id","articles").attr("transform","translate(30,"+margin.top+")").selectAll("g").data(filtered_data).enter().append("g").attr("class","article").attr("id",(function(t,i){return i})).attr("data-article",(function(t,i){return t.article})).attr("data-subject",(function(t,i){return t.subject})).attr("transform",(function(t,i){return"translate("+(s(i)+50)+",0)"})).on("mouseover",d.show).on("mouseout",d.hide).append("g").attr("class","article_circles").attr("transform",(function(t,i){return"translate(0,"+l(+t.avg_pv)+")"})).attr("id",(function(t,i){return"id_"+t.id_wikidata})).on("mouseover",(function(){d3.selectAll(".article_circles,.line_prev,.circle_prev").transition().duration(0).attr("opacity",.2),d3.select(this).transition().duration(0).attr("opacity",1),d3.select(this.previousSibling).select(".circle_prev,.line_prev").transition().duration(0).attr("opacity",1)})).on("mouseout",(function(){d3.selectAll(".article_circles").transition().duration(0).attr("opacity",1),d3.selectAll(".variation").select(".circle_prev").transition().duration(0).attr("opacity",0),d3.selectAll(".variation").select(".line_prev").transition().duration(0).attr("opacity",.7)})).append("a").attr("xlink:href",(function(t,i){return wiki_link+t.article})).attr("target","_blank"),g=(u.append("circle").transition().duration(500).delay((function(t,i){return 2*i})).attr("cx",0).attr("cy",0).attr("fill",(function(t,i){return"#00b2ff"})).attr("opacity",.5).attr("r",0).transition().ease(d3.easeLinear).duration(500).attr("r",(function(t,i){return n(Math.sqrt(t.size/3.14))})).attr("data-size",(function(t,i){return t.size})),u.append("circle").transition().duration(500).delay((function(t,i){return 2*i})).attr("cx",0).attr("cy",0).attr("fill",(function(t,i){return"#00b2ff"})).attr("opacity",.5).attr("r",(function(t,i){return n(Math.sqrt(t.incipit_size/3.14))})).attr("data-incipit",(function(t,i){return t.incipit_size}))),p=u.append("circle").transition().duration(500).delay((function(t,i){return 2*i})).attr("cx",0).attr("cy",0).attr("stroke",(function(t,i){return"#00b2ff"})).attr("fill","transparent").attr("stroke-width",.5).attr("opacity",.9).attr("r",0).transition().delay(500).ease(d3.easeLinear).duration(500).attr("r",(function(t,i){return n(Math.sqrt(t.discussion_size/3.14))}))}))}function format_data(t){return t.forEach((function(t,i){t.average_daily_visit=+t.average_daily_visit,t.article=t.article.replace(/_/g," "),t.size=+t.size,t.discussion_size=+t.discussion_size,t.incipit_size=+t.incipit_size,t.avg_pv=+t.avg_pv,t.avg_pv_prev=+t.avg_pv_prev,t.issue_clarify=+t.issue_clarify,"-"!==t.references?t.references=+t.references:t.references=0,"-"!==t.issues?t.issues=+t.issues:t.issues=0,"-"!==t.notes?t.notes=+t.notes:t.notes=0,"-"!==t.images?t.images=+t.images:t.images=0,t.features=t.references+t.notes+t.images})),t}window.onload=function(){dv2()};